//minified by yuicompressor
var O2={};function __inheritedThisMacroString(a){return a.toString().replace(/__inherited\s*\(/mg,"__inheritedCaller(this, ").replace(/__inheritedCaller\s*\(\s*this,\s*\)/mg,"__inheritedCaller(this)")}function __inheritedCaller(){var b=__inheritedCaller.caller;var a=arguments[0];var c;if("__inherited" in b){c=Array.prototype.slice.call(arguments,1);return b.__inherited.apply(a,c)}else{throw new Error("o2: no __inherited")}}Function.prototype.createClass=function(b){var a;a=function(){if("__construct" in this){this.__construct.apply(this,arguments)}};if(b===undefined){return a}else{if(typeof b==="object"){return a.extendPrototype(b)}else{return null}}};Function.prototype.extendPrototype=function(aDefinition){var iProp="",f,fInherited;if(aDefinition instanceof Function){aDefinition=aDefinition.prototype}for(iProp in aDefinition){f=aDefinition[iProp];if(iProp in this.prototype&&(this.prototype[iProp] instanceof Function)){fInherited=this.prototype[iProp];if(f instanceof Function){eval("f = "+__inheritedThisMacroString(f.toString()));this.prototype[iProp]=f;this.prototype[iProp].__inherited=fInherited}else{throw new Error("o2: method "+iProp+" overridden by property.")}}else{this.prototype[iProp]=aDefinition[iProp]}}return this};Function.prototype.extendClass=function(a,c){var b=this.createClass().extendPrototype(a).extendPrototype(c);return b};O2.createObject=function(c,b){var g=c.split(".");var f=g.pop();var d=window;var e;while(g.length){e=g.shift();if(!(e in d)){d[e]={}}d=d[e]}if(!(f in d)){d[f]=b}else{for(var a in b){d[f][a]=b[a]}}};O2._loadObject=function(b){var c=b.split(".");var a=window;while(c.length>1){a=a[c.shift()]}var d=c[0];return a[d]};O2.createClass=function(b,a){O2.createObject(b,Function.createClass(a))};O2.extendClass=function(c,a,b){if(typeof a==="string"){a=O2._loadObject(a)}O2.createObject(c,Function.extendClass(a,b))};O2.createClass("Kagami.Interval",{_time:0,_timer:false,show:false,elmtTimer:false,elmtTime:false,currentTime:false,timeToSync:false,__construct:function(){this.elmtTimer=document.createElement("div");this.elmtTimer.setAttribute("class","timer");this.elmtTimer.style="position:absolute;top:0;left:0;";var a=document.createElement("span");a.innerHTML="timer: ";this.elmtTime=document.createElement("span");this.elmtTime.setAttribute("id","time");this.elmtTimer.appendChild(a);this.elmtTimer.appendChild(this.elmtTime);document.getElementsByTagName("body")[0].appendChild(this.elmtTimer);this.currentTime=Math.floor(Date.now()/1000)},_interval:function(){this._time++;this.elmtTime.innerHTML=this._time+" s"},start:function(){this._timer=setInterval((function(){this._interval()}).bind(this),1000)},stop:function(){clearInterval(this._timer);this._time=0},pause:function(){clearInterval(this._timer)},resume:function(){this.start()},getTime:function(){return this._time},show:function(){this.elmtTimer.style.display="block"},getCurrentTime:function(){return Date.now()/1000|0},synchronize:function(a){this.stop();while(this.getCurrentTime()<a){}this.start()}});O2.createClass("Kagami.Log",{TYPE_INFO:"INFO",TYPE_WARNING:"WARNING",TYPE_ERROR:"ERROR",_sHost:"",_bConsole:false,__construct:function(a,b){this._sHost=a.toUpperCase();this._bConsole=b},log:function(c,b){if(!b){b=this.TYPE_INFO}var a="## "+this._sHost+" ##::: "+b+": ";if(this._bConsole){console.log(a,c)}},error:function(a){this.log(a,this.TYPE_ERROR);throw new Error(a)},warning:function(a){this.warn(a,this.TYPE_ERROR)},info:function(a){this.log(a,this.TYPE_INFO)}});O2.createClass("Kagami.Controller",{uid:false,_sSelf:false,_sHost:false,_sHostUid:false,_oHost:false,_children:{},_queriesSending:{},_queriesRecieving:{},_actionsAllowed:{iAmYourFather:"action_iAmYourFather",synchronize:"action_synchronize",familyGrowUp:"action_familyGrowUp"},_bRecognitionPaternity:false,oDocKagamiId:false,_events:{familyGrowUp:new Event("familyGrowUp"),synchronize:new Event("synchronize")},_cloudTargets:[],__construct:function(a){this.getUid();this._logger=new Kagami.Log(this._sSelf,a);this._interval=new Kagami.Interval();this._interval.start();this.setPossibleTarget(this.getUid());window.addEventListener("message",(this._onMessage).bind(this),false);if(typeof JSON.clone!=="function"){JSON.clone=function(b){return JSON.parse(JSON.stringify(b))}}},_action:function(a){if(!("action" in a)){this.getLogger().warning("doesn't know which action to do")}else{if(!(a.action in this._actionsAllowed)){if(!(a.action in this._events)){this.getLogger().error("action "+a.action+" not allowed, and no event defined")}else{console.log("test event",this._events[a.action]);this._events[a.action].data=a.data;this._events[a.action].from=a.from;this._events[a.action].originalFrom=a.originalFrom;this.trigger(a.action);if("callback" in a&&a.callback!==false){this._respond(a)}}}else{var b="action_"+a.action;this[b](a,(function(c){if("callback" in c&&c.callback!==false){this._respond(c)}}).bind(this))}}},_addEvent:function(a){this._events[a]=new Event(a)},_answer:function(a){if(a.uid in this._queriesSending){this.getLogger().info("response direct de from "+a.from+"("+a.originalTo+")");if(this._queriesSending[a.uid].callback!==false){if(typeof this._queriesSending[a.uid].callback=="function"){this._queriesSending[a.uid].callback(this,a.originalTo,a.data)}else{}}}else{this.getLogger().info("la requête "+a.uid+" de "+a.from+" n'est pas une réponse à l'une de mes requête, elle sera ignorée")}},_broadcast:function(a){a.type="broadcast";a.broadcasted.push(this.uid);var b=this._getRestTargets(a.broadcasted);b.forEach((function(c){a.to=c;this._send(a)}).bind(this))},_getNoDirectTargets:function(d){var c=[];var a=this.getProbableTargets();a.push(this.uid);a.push(d);var b=this.getPossibleTargets();b.forEach(function(e){if(a.indexOf(e)<0){c.push(e)}});return c},_getRestTargets:function(c){var b=[];var a=this.getProbableTargets();a.forEach(function(d){if(!c||c.length==0||c.indexOf(d)<0){b.push(d)}});return b},_onMessage:function(a){var b=JSON.parse(a.data);b.source=a.source;b.origin=a.origin;if(!("uid" in b)){this.getLogger().warning("recieving message from unknown")}else{if(b.to==this.getUid()){this._queriesRecieving[b.uid]=b;switch(b.type){case"query":this._action(b);break;case"broadcast":this._action(b);this._broadcast(b);break;case"response":this._answer(b);break;case"transmis":if(this.uid==b.originalTo){this._action(b)}else{this._transmission(b)}break;case"transmis_response":if(this.uid==b.originalFrom){this._answer(b)}else{if(b.transmitter.length>0){b.to=b.transmitter.pop();if(this.uid==b.to&&b.transmitter.length>0){b.to=b.transmitter.pop()}this._send(b)}}break;case"broadcast_response":if(this.uid==b.broadcaster){this._answer(b)}else{if(b.broadcasted.length>0){b.to=b.broadcasted.pop();if(this.uid==b.to){b.to=b.broadcasted.pop()}this._send(b)}}break;default:break}}else{this.getLogger().info("target is "+b.to+" and i am "+this.getUid())}}},_respond:function(a){a.to=a.from;if(a.type=="broadcast"){a.type="broadcast_response";a.originalTo=this.uid}else{if("transmitter" in a){a.type="transmis_response";a.originalTo=this.uid}else{a.type="response"}}this._send(a)},_send:function(a){var c=false;if(a.callback!==false&&typeof a.callback!="undefined"){c=a.callback;a.callback=true}if("source" in a){delete a.source}if("origin" in a){delete a.origin}a.from=this.uid;var b=this.getFrame(a.to);if(b){b.frame.contentWindow.postMessage(JSON.stringify(a),b.domain)}else{if(this.hasParent()&&a.to==this._sHostUid){this._oHost.postMessage(JSON.stringify(a),this._sHost)}else{if(this.getPossibleTargets().indexOf(a.to)>0){this.getLogger().error("le calcul de transmis doit se faire en amont")}else{this.getLogger().error("no target to send")}}}if(a.callback!==false){a.callback=c}this._queriesSending[a.uid]=a},_transmission:function(b){var a=this.getProbableTargets();b.byUid=this.uid;b.type="transmis";b.transmitter.push(this.uid);a.forEach((function(c){if(c!=b.from){b.to=c;b.from=this.uid;this._send(b)}}).bind(this))},addFrame:function(c,d){var a="kagami_"+new Date().getTime();oFrame=document.createElement("iframe");if(c){oFrame.src=c+"?kagami_uid="+a}else{this.logger.error("la source de l'iframe n'est pas donné")}oFrame.setAttribute("data-id",a);if(oFrame.id==""){oFrame.id="frame_"+a}var b={domain:this.getDomainFromURL(oFrame.src),frame:oFrame,uid:a,id:oFrame.id};this._children[a]=b;oFrame.onload=(function(){this.order_iAmYourFather(b.uid,d);this.order_familyGrowUp(b.uid)}).bind(this);oFrame.onerror=(function(){this.getLogger().error("url target don't load: "+sSrc)}).bind(this);return oFrame},broadcast:function(c,b,d){if(!c||typeof c=="undefined"){c=false}if(!b||typeof b=="undefined"){b=false}if(!d||typeof d=="undefined"){d=false}var a={uid:new Date().getTime(),from:this.uid,to:false,action:c,data:b,callback:d,cloud:this.getPossibleTargets(),type:"broadcast",broadcasted:[],broadcaster:this.uid,originalTo:this.uid,originalFrom:this.uid};this._broadcast(a)},getDomainFromURL:function(b){var a=document.createElement("a");a.href=b;return a.protocol+"//"+a.hostname},getFrame:function(a){if(a in this._children){return this._children[a]}else{return false}},getInterval:function(){return this._interval},getLogger:function(){return this._logger},getProbableTargets:function(){var a=[];for(var b in this._children){a.push(b)}if(this.hasParent()){a.push(this._sHostUid)}return a},getPossibleTargets:function(){return this._cloudTargets},getUid:function(){if(this.uid===false){var b=this.getUrlVars();if("kagami_uid" in b){this.uid=b.kagami_uid}else{this.uid="kagami_"+new Date().getTime()}var a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("id","kagami_uid");a.setAttribute("name","kagami_uid");a.setAttribute("value",this.uid);document.getElementsByTagName("body")[0].appendChild(a);this.oDocKagamiId=a}this._sSelf=document.location.protocol+"//"+document.domain;return this.uid},getUrlVars:function(){var b={};var a=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(c,d,e){b[d]=e});return b},hasParent:function(){if(this._bRecognitionPaternity){return true}else{return false}},on:function(a,b){this._addEvent(a);window.addEventListener(a,b,false)},send:function(a,d,c,e){var b={uid:new Date().getTime(),from:this.uid,to:a,action:d,data:c,cloud:this.getPossibleTargets(),callback:e,type:"query",originalTo:a,originalFrom:this.uid};if(this.getProbableTargets().indexOf(b.to)>=0){this._send(b)}else{b.transmitter=[];this._transmission(b)}},setPossibleTarget:function(a){if(this._cloudTargets.indexOf(a)<0){this._cloudTargets.push(a)}},trigger:function(a){if(a in this._events){window.dispatchEvent(this._events[a])}else{this.getLogger().error("event "+a+" not allowed;")}},order_iAmYourFather:function(a,b){this.send(a,"iAmYourFather",true,(function(c,d){if(b){b(c,d)}}).bind(this))},order_synchronize:function(b){var a=parseInt(this.getInterval().getCurrentTime()+1);this.getInterval().synchronize(a);this.trigger("synchronize");this.broadcast("synchronize",a,b)},order_familyGrowUp:function(a,b){this.setPossibleTarget(a);this.trigger("familyGrowUp");this.broadcast("familyGrowUp",this.getPossibleTargets(),b)},action_iAmYourFather:function(b,a){this.getLogger().info("doing action iAmYourFather");this._sHost=b.origin;this._sHostUid=b.from;this._oHost=b.source;this._bRecognitionPaternity=true;b.data="i am your son";a(b)},action_test:function(b,a){this.getLogger().info("doing action test");b.data="test succeed";if(a){a(b)}},action_synchronize:function(b,a){this.getLogger().info("doing action synchronize");this.getInterval().synchronize(b.data);b.data="synchronized";this.trigger("synchronize");if(a){a(b)}},action_familyGrowUp:function(b,a){this.getLogger().info("doing action familyGrowUp");b.data.forEach((function(c){this.setPossibleTarget(c)}).bind(this));this.trigger("familyGrowUp");if(a){a(b)}}});//minified by yuicompressor
//script /var/www/kagami/o2.js
var O2={};function __inheritedThisMacroString(a){return a.toString().replace(/__inherited\s*\(/mg,"__inheritedCaller(this, ").replace(/__inheritedCaller\s*\(\s*this,\s*\)/mg,"__inheritedCaller(this)")}function __inheritedCaller(){var b=__inheritedCaller.caller;var a=arguments[0];var c;if("__inherited" in b){c=Array.prototype.slice.call(arguments,1);return b.__inherited.apply(a,c)}else{throw new Error("o2: no __inherited")}}Function.prototype.createClass=function(b){var a;a=function(){if("__construct" in this){this.__construct.apply(this,arguments)}};if(b===undefined){return a}else{if(typeof b==="object"){return a.extendPrototype(b)}else{return null}}};Function.prototype.extendPrototype=function(aDefinition){var iProp="",f,fInherited;if(aDefinition instanceof Function){aDefinition=aDefinition.prototype}for(iProp in aDefinition){f=aDefinition[iProp];if(iProp in this.prototype&&(this.prototype[iProp] instanceof Function)){fInherited=this.prototype[iProp];if(f instanceof Function){eval("f = "+__inheritedThisMacroString(f.toString()));this.prototype[iProp]=f;this.prototype[iProp].__inherited=fInherited}else{throw new Error("o2: method "+iProp+" overridden by property.")}}else{this.prototype[iProp]=aDefinition[iProp]}}return this};Function.prototype.extendClass=function(a,c){var b=this.createClass().extendPrototype(a).extendPrototype(c);return b};O2.createObject=function(c,b){var g=c.split(".");var f=g.pop();var d=window;var e;while(g.length){e=g.shift();if(!(e in d)){d[e]={}}d=d[e]}if(!(f in d)){d[f]=b}else{for(var a in b){d[f][a]=b[a]}}};O2._loadObject=function(b){var c=b.split(".");var a=window;while(c.length>1){a=a[c.shift()]}var d=c[0];return a[d]};O2.createClass=function(b,a){O2.createObject(b,Function.createClass(a))};O2.extendClass=function(c,a,b){if(typeof a==="string"){a=O2._loadObject(a)}O2.createObject(c,Function.extendClass(a,b))};//-------------------
//script /var/www/kagami/interval.js
O2.createClass("Kagami.Interval",{_time:0,_timer:false,show:false,elmtTimer:false,elmtTime:false,currentTime:false,timeToSync:false,__construct:function(){this.elmtTimer=document.createElement("div");this.elmtTimer.setAttribute("class","timer");this.elmtTimer.style="position:absolute;top:0;left:0;";var a=document.createElement("span");a.innerHTML="timer: ";this.elmtTime=document.createElement("span");this.elmtTime.setAttribute("id","time");this.elmtTimer.appendChild(a);this.elmtTimer.appendChild(this.elmtTime);document.getElementsByTagName("body")[0].appendChild(this.elmtTimer);this.currentTime=Math.floor(Date.now()/1000)},_interval:function(){this._time++;this.elmtTime.innerHTML=this._time+" s"},start:function(){this._timer=setInterval((function(){this._interval()}).bind(this),1000)},stop:function(){clearInterval(this._timer);this._time=0},pause:function(){clearInterval(this._timer)},resume:function(){this.start()},getTime:function(){return this._time},show:function(){this.elmtTimer.style.display="block"},getCurrentTime:function(){return Date.now()/1000|0},synchronize:function(a){this.stop();while(this.getCurrentTime()<a){}this.start()}});//-------------------
//script /var/www/kagami/log.js
O2.createClass("Kagami.Log",{TYPE_INFO:"INFO",TYPE_WARNING:"WARNING",TYPE_ERROR:"ERROR",_sHost:"",_bConsole:false,__construct:function(a,b){this._sHost=a.toUpperCase();this._bConsole=b},log:function(c,b){if(!b){b=this.TYPE_INFO}var a="## "+this._sHost+" ##::: "+b+": ";if(this._bConsole){console.log(a,c)}},error:function(a){this.log(a,this.TYPE_ERROR);throw new Error(a)},warning:function(a){this.warn(a,this.TYPE_ERROR)},info:function(a){this.log(a,this.TYPE_INFO)}});//-------------------
//script /var/www/kagami/kagami.js
O2.createClass("Kagami.Controller",{uid:false,_sSelf:false,_sHost:false,_sHostUid:false,_oHost:false,_children:{},_queriesSending:{},_queriesRecieving:{},_actionsAllowed:{iAmYourFather:"action_iAmYourFather",synchronize:"action_synchronize",familyGrowUp:"action_familyGrowUp"},_bRecognitionPaternity:false,oDocKagamiId:false,_events:{familyGrowUp:new Event("familyGrowUp"),synchronize:new Event("synchronize")},_cloudTargets:[],__construct:function(a){this.getUid();this._logger=new Kagami.Log(this._sSelf,a);this._interval=new Kagami.Interval();this._interval.start();this.setPossibleTarget(this.getUid());window.addEventListener("message",(this._onMessage).bind(this),false);if(typeof JSON.clone!=="function"){JSON.clone=function(b){return JSON.parse(JSON.stringify(b))}}},_action:function(a){if(!("action" in a)){this.getLogger().warning("doesn't know which action to do")}else{if(!(a.action in this._actionsAllowed)){if(!(a.action in this._events)){this.getLogger().error("action "+a.action+" not allowed, and no event defined")}else{console.log("test event",this._events[a.action]);this._events[a.action].data=a.data;this._events[a.action].from=a.from;this._events[a.action].originalFrom=a.originalFrom;this.trigger(a.action);if("callback" in a&&a.callback!==false){this._respond(a)}}}else{var b="action_"+a.action;this[b](a,(function(c){if("callback" in c&&c.callback!==false){this._respond(c)}}).bind(this))}}},_addEvent:function(a){this._events[a]=new Event(a)},_answer:function(a){if(a.uid in this._queriesSending){this.getLogger().info("response direct de from "+a.from+"("+a.originalTo+")");if(this._queriesSending[a.uid].callback!==false){if(typeof this._queriesSending[a.uid].callback=="function"){this._queriesSending[a.uid].callback(this,a.originalTo,a.data)}else{}}}else{this.getLogger().info("la requête "+a.uid+" de "+a.from+" n'est pas une réponse à l'une de mes requête, elle sera ignorée")}},_broadcast:function(a){a.type="broadcast";a.broadcasted.push(this.uid);var b=this._getRestTargets(a.broadcasted);b.forEach((function(c){a.to=c;this._send(a)}).bind(this))},_getNoDirectTargets:function(d){var c=[];var a=this.getProbableTargets();a.push(this.uid);a.push(d);var b=this.getPossibleTargets();b.forEach(function(e){if(a.indexOf(e)<0){c.push(e)}});return c},_getRestTargets:function(c){var b=[];var a=this.getProbableTargets();a.forEach(function(d){if(!c||c.length==0||c.indexOf(d)<0){b.push(d)}});return b},_onMessage:function(a){var b=JSON.parse(a.data);b.source=a.source;b.origin=a.origin;if(!("uid" in b)){this.getLogger().warning("recieving message from unknown")}else{if(b.to==this.getUid()){this._queriesRecieving[b.uid]=b;switch(b.type){case"query":this._action(b);break;case"broadcast":this._action(b);this._broadcast(b);break;case"response":this._answer(b);break;case"transmis":if(this.uid==b.originalTo){this._action(b)}else{this._transmission(b)}break;case"transmis_response":if(this.uid==b.originalFrom){this._answer(b)}else{if(b.transmitter.length>0){b.to=b.transmitter.pop();if(this.uid==b.to&&b.transmitter.length>0){b.to=b.transmitter.pop()}this._send(b)}}break;case"broadcast_response":if(this.uid==b.broadcaster){this._answer(b)}else{if(b.broadcasted.length>0){b.to=b.broadcasted.pop();if(this.uid==b.to){b.to=b.broadcasted.pop()}this._send(b)}}break;default:break}}else{this.getLogger().info("target is "+b.to+" and i am "+this.getUid())}}},_respond:function(a){a.to=a.from;if(a.type=="broadcast"){a.type="broadcast_response";a.originalTo=this.uid}else{if("transmitter" in a){a.type="transmis_response";a.originalTo=this.uid}else{a.type="response"}}this._send(a)},_send:function(a){var c=false;if(a.callback!==false&&typeof a.callback!="undefined"){c=a.callback;a.callback=true}if("source" in a){delete a.source}if("origin" in a){delete a.origin}a.from=this.uid;var b=this.getFrame(a.to);if(b){b.frame.contentWindow.postMessage(JSON.stringify(a),b.domain)}else{if(this.hasParent()&&a.to==this._sHostUid){this._oHost.postMessage(JSON.stringify(a),this._sHost)}else{if(this.getPossibleTargets().indexOf(a.to)>0){this.getLogger().error("le calcul de transmis doit se faire en amont")}else{this.getLogger().error("no target to send")}}}if(a.callback!==false){a.callback=c}this._queriesSending[a.uid]=a},_transmission:function(b){var a=this.getProbableTargets();b.byUid=this.uid;b.type="transmis";b.transmitter.push(this.uid);a.forEach((function(c){if(c!=b.from){b.to=c;b.from=this.uid;this._send(b)}}).bind(this))},addFrame:function(c,d){var a="kagami_"+new Date().getTime();oFrame=document.createElement("iframe");if(c){oFrame.src=c+"?kagami_uid="+a}else{this.logger.error("la source de l'iframe n'est pas donné")}oFrame.setAttribute("data-id",a);if(oFrame.id==""){oFrame.id="frame_"+a}var b={domain:this.getDomainFromURL(oFrame.src),frame:oFrame,uid:a,id:oFrame.id};this._children[a]=b;oFrame.onload=(function(){this.order_iAmYourFather(b.uid,d);this.order_familyGrowUp(b.uid)}).bind(this);oFrame.onerror=(function(){this.getLogger().error("url target don't load: "+sSrc)}).bind(this);return oFrame},broadcast:function(c,b,d){if(!c||typeof c=="undefined"){c=false}if(!b||typeof b=="undefined"){b=false}if(!d||typeof d=="undefined"){d=false}var a={uid:new Date().getTime(),from:this.uid,to:false,action:c,data:b,callback:d,cloud:this.getPossibleTargets(),type:"broadcast",broadcasted:[],broadcaster:this.uid,originalTo:this.uid,originalFrom:this.uid};this._broadcast(a)},getDomainFromURL:function(b){var a=document.createElement("a");a.href=b;return a.protocol+"//"+a.hostname},getFrame:function(a){if(a in this._children){return this._children[a]}else{return false}},getInterval:function(){return this._interval},getLogger:function(){return this._logger},getProbableTargets:function(){var a=[];for(var b in this._children){a.push(b)}if(this.hasParent()){a.push(this._sHostUid)}return a},getPossibleTargets:function(){return this._cloudTargets},getUid:function(){if(this.uid===false){var b=this.getUrlVars();if("kagami_uid" in b){this.uid=b.kagami_uid}else{this.uid="kagami_"+new Date().getTime()}var a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("id","kagami_uid");a.setAttribute("name","kagami_uid");a.setAttribute("value",this.uid);document.getElementsByTagName("body")[0].appendChild(a);this.oDocKagamiId=a}this._sSelf=document.location.protocol+"//"+document.domain;return this.uid},getUrlVars:function(){var b={};var a=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(c,d,e){b[d]=e});return b},hasParent:function(){if(this._bRecognitionPaternity){return true}else{return false}},on:function(a,b){this._addEvent(a);window.addEventListener(a,b,false)},send:function(a,d,c,e){var b={uid:new Date().getTime(),from:this.uid,to:a,action:d,data:c,cloud:this.getPossibleTargets(),callback:e,type:"query",originalTo:a,originalFrom:this.uid};if(this.getProbableTargets().indexOf(b.to)>=0){this._send(b)}else{b.transmitter=[];this._transmission(b)}},setPossibleTarget:function(a){if(this._cloudTargets.indexOf(a)<0){this._cloudTargets.push(a)}},trigger:function(a){if(a in this._events){window.dispatchEvent(this._events[a])}else{this.getLogger().error("event "+a+" not allowed;")}},order_iAmYourFather:function(a,b){this.send(a,"iAmYourFather",true,(function(c,d){if(b){b(c,d)}}).bind(this))},order_synchronize:function(b){var a=parseInt(this.getInterval().getCurrentTime()+1);this.getInterval().synchronize(a);this.trigger("synchronize");this.broadcast("synchronize",a,b)},order_familyGrowUp:function(a,b){this.setPossibleTarget(a);this.trigger("familyGrowUp");this.broadcast("familyGrowUp",this.getPossibleTargets(),b)},action_iAmYourFather:function(b,a){this.getLogger().info("doing action iAmYourFather");this._sHost=b.origin;this._sHostUid=b.from;this._oHost=b.source;this._bRecognitionPaternity=true;b.data="i am your son";a(b)},action_test:function(b,a){this.getLogger().info("doing action test");b.data="test succeed";if(a){a(b)}},action_synchronize:function(b,a){this.getLogger().info("doing action synchronize");this.getInterval().synchronize(b.data);b.data="synchronized";this.trigger("synchronize");if(a){a(b)}},action_familyGrowUp:function(b,a){this.getLogger().info("doing action familyGrowUp");b.data.forEach((function(c){this.setPossibleTarget(c)}).bind(this));this.trigger("familyGrowUp");if(a){a(b)}}});//-------------------
